extends layout

block content
  .card
    .card-header
      h2.card-title Vis√£o geral do fluxo OpenID Connect
    p.meta
      | Esta p√°gina descreve, passo a passo, o que acontece quando clicas em ‚ÄúLogin com Google‚Äù:
      |  o browser fala com esta app, esta app fala com o Google e os tokens fluem de volta.

    ol
      li O browser chama esta aplica√ß√£o e inicia o redirecionamento para o Google (OpenID Provider).
      li O Google autentica-te, pede consentimento e prepara um ID Token com a tua identidade.
      li Um c√≥digo de autoriza√ß√£o ef√©mero √© enviado de volta para o backend desta app.
      li O backend troca esse c√≥digo por tokens (Access Token + ID Token) atrav√©s de canais seguros.
      li A aplica√ß√£o valida o ID Token, cria/atualiza o utilizador na base de dados (Prisma) e abre uma sess√£o.
      li A partir da√≠, cada pedido traz um cookie de sess√£o e d√°-te acesso ao dashboard protegido.

    p.meta
      | Em termos de pap√©is: esta app √© o Relying Party (RP) e o Google √© o OpenID Provider (OP).
      |  O background animado representa esse fluxo cont√≠nuo de dados entre browser, OP e RP.

    if !user
      .btn-row
        a.btn.btn-primary(href="/auth/google") ‚û°Ô∏è Login com Google
        if showDevLogin
          a.btn.btn-ghost(href="/dev-login") Dev login (local)
    else
      p.meta
        | Sess√£o ativa como 
        strong  #{user.email || user.name}.
      .btn-row
        a.btn.btn-primary(href="/dashboard") üîê Ir para Dashboard
        a.btn.btn-ghost(href="/logout") Logout
